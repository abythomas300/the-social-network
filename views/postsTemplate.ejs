<!DOCTYPE html>
<html lang="en">
<%- include('partials/_head') %>
<body>

    <!-- Helper function to convert date from YYYY-MM-DD to DD-MM-YYYY -->
    <% function dateConversion(dateInYMD){
        const parts = dateInYMD.split('-')
        const dateInDMY = `${parts[2]}-${parts[1]}-${parts[0]}`
        return dateInDMY;
    }%>

    <%if(data.message.length > 0) {%>

        <div class="alert alert-success fade show d-flex align-items-center justify-content-center gap-3" style="position: absolute;z-index: 2;"  role="alert">
            <%= data.message %>
            <button type="button" class="btn-close" data-bs-dismiss="alert" ></button>
        </div>

    <%}%>

    <%- include('partials/_header') %>
    
    <%- include('partials/_navbar') %>

    

    <!--Template for displaying all blog posts -->
    
    <%if(data.blogs.length > 0) {%>

            <%data.blogs.forEach(function(blog){%>
                    
                <div class="container my-5">
                    <div class="row">
                        <div class="col-md-8 offset-md-2">
                            <h4 class="display-4 text-center mb-4"><%= blog.title %></h4>
                            <p class="text-muted text-center mb-4">Posted by <span class="fst-italic fw-bold"><%= blog.author.username %></span> on <%= dateConversion(blog.createdAt.toISOString().substring(0,10)) %></p>
                            <div class="content">
                                <p><%= blog.content %></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container mb-5">
                    <div class="row">
                        <div class="col-md-8 offset-md-2 ">
                            <button class="btn btn-outline-primary btn-sm"><i class="bi bi-heart"><span style="font-style: normal; font-size: large;"> 0</span></i></button>
                            <button class="btn btn-outline-primary btn-sm"><i class="bi bi-chat-left-dots"><span style="font-style: normal; font-size: large;"> 0</span></i></button>
                            <button class="btn btn-outline-primary"><i class="bi bi-pencil-square"></i></button>
                            <button class="btn btn-outline-primary" onclick="submitDeleteForm('<%=blog._id%>')"><i class="bi bi-trash3"></i></button>
                            <button class="btn btn-outline-primary"><i class="bi bi-three-dots"></i></button>
                        </div>
                    </div>
                </div>
                <hr class="hr">

            <%})%>

    <%} else {%>

        <div class="container my-5">
            <h4 class="display-4 text-center mb-4">No new posts for now</h4>
        </div>

    <%}%>
    
    <%- include('partials/_footer') %>

    <!-- Delete Blog Form -->
    <form action="" method="POST" id="blogDeleteForm"></form>  <!-- action URL will be set in the submitDeleteForm() method -->
    
    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // method to submit the blog delete form
        function submitDeleteForm(blogId){
            console.log("ID of the blog passed to submitDeleteFrom() method: ", blogId)
            const blogDeleteForm = document.getElementById('blogDeleteForm')
            blogDeleteForm.action = `/post/${blogId}?_method=DELETE` 
            blogDeleteForm.submit()
        }
    </script>

</body>
</html>