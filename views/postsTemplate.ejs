<!DOCTYPE html>
<html lang="en">
<%- include('partials/_head') %>
<style>
    .blog-container {
        padding: 2rem 0;
    }

    .blog-image {
        /* Ensures the image fills its container and is responsive */
        width: 100%;
        height: auto;
        max-height: 500px; /* Optional: Set a max height for larger screens */
        object-fit: cover; /* Ensures the image aspect ratio is maintained and it covers the space */
        border-radius: 4px; /* Optional: Add rounded corners to the image */
    }
    
    .blog-content {
        padding: 2rem;
    }

    /* Add custom spacing between the columns on large screens */
    @media (min-width: 992px) {
        .blog-image-col {
            padding-right: 1rem;
        }
        .blog-text-col {
            padding-left: 1rem;
        }
    }

    .button-section {
        display: flex;
        gap: 0.5rem; /* Adds space between the buttons */
        flex-wrap: wrap; /* Allows buttons to wrap to the next line on small screens */
        padding: 1rem 0;
        border-top: 1px solid #e9ecef; /* A subtle line to separate from content */
        margin-top: 2rem;
    }

    .button-section .btn {
        font-size: 1.25rem; /* Larger icon size */
        padding: 0.5rem 0.75rem;
    }
</style>
<body>


    <!-- Helper function to convert date from YYYY-MM-DD to DD-MM-YYYY -->
    <% function dateConversion(dateInYMD){
        const parts = dateInYMD.split('-')
        const dateInDMY = `${parts[2]}-${parts[1]}-${parts[0]}`
        return dateInDMY;
    }%>


    <%if(data.message.length > 0) {%>

        <div class="toast-container position-fixed bottom-0 end-0 p-3">
          <div id="liveToast" class="toast" role="alert" >
            <div class="toast-body bg-success bg-gradient text-white">
              <%=data.message%>
            </div>
          </div>
        </div>

    <%}%>

    <%- include('partials/_header') %>
    
    <%- include('partials/_navbar') %>

    

    <!--Template for displaying all blog posts -->
    
    <%if(data.blogs.length > 0) {%>

            <%data.blogs.forEach(function(blog){%>
                    
                <div class="container blog-container">
                    <div class="row">
                
                        <!-- Image column -->
                        <div class="col-lg-6 blog-image-col mt-5">
                            <img src="/uploads/<%=blog.thumbnail%>" alt="Mastering The Art Of Public Speaking" class="img-fluid blog-image">
                        </div>
                
                        <!-- Text content column -->
                        <div class="col-lg-6 blog-text-col">
                            <div class="blog-content">
                                <h1 class="display-5 fw-bold lh-2"><%= blog.title %></h1>
                                <p class="lead mt-4"><%= blog.content %></p>
                                <p class="text-muted medium mt-4">Posted by <span class="fst-italic fw-semibold mx-1"> <%= blog.author.username %> </span> on <%= dateConversion(blog.createdAt.toISOString().substring(0,10)) %></p>
                                <!-- Option Buttons -->
                                <div class="button-section mx-2">
                                    <button class="btn btn-outline-primary btn-sm"><i class="bi bi-heart"></i><span style="font-style: normal; font-size: large;"> 0</span></button>
                                    <button class="btn btn-outline-primary btn-sm"><i class="bi bi-chat-left-dots"></i><span style="font-style: normal; font-size: large;"> 0</span></button>

                                    <!-- Checking whether author of a blog is logged in  -->
                                    <%if(data.currentUser.userId === blog.author._id.toString()){%>
                                        <a href="/post/editBlog/<%=blog._id%>"><button class="btn btn-outline-primary"><i class="bi bi-pencil-square"></i></button></a>
                                        <button class="btn btn-outline-primary" onclick="submitDeleteForm('<%=blog._id%>')"><i class="bi bi-trash3"></i></button>
                                    <%}%>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>             

            <hr class="hr">

            <%})%>

    <%} else {%>

        <div class="container my-5">
            <h4 class="display-4 text-center mb-4">No new posts for now</h4>
        </div>

    <%}%>
    

    <%- include('partials/_footer') %>


    <!-- Delete Blog Form -->
    <form action="" method="POST" id="blogDeleteForm"></form>  <!-- action URL will be set in the submitDeleteForm() method -->
    

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // initializing BS Toast component
    document.addEventListener('DOMContentLoaded', function() {
    var toastElement = document.getElementById('liveToast');
    if (toastElement) {
      var toast = new bootstrap.Toast(toastElement); // Calling BS toast function
      toast.show(); 

      // Hide toast after 3 seconds 
      setTimeout(function() {
        toast.hide();
      }, 3000);
     }
    });


    // method to submit the blog delete form
    function submitDeleteForm(blogId){
        console.log("ID of the blog passed to submitDeleteFrom() method: ", blogId)
        const blogDeleteForm = document.getElementById('blogDeleteForm')
        blogDeleteForm.action = `/post/${blogId}?_method=DELETE` 
        blogDeleteForm.submit()
    }
    </script>

</body>
</html>